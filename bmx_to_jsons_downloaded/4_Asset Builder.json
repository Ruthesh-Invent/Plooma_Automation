{
  "AssetBuilder": {
    "Bots": {
      "Process": [],
      "Bot": []
    },
    "Functions": [
      {
        "Id": "03b93848a351b8fb0ba6b733165516cc",
        "SubscriptionId": "160fcc8dd85b45db8c0ae8b96df54c99",
        "LibraryName": "Download PDF Document By Docid",
        "EndpointUrl": "https://dev.botminds.ai/a/prefect/tasks/pythonOperator",
        "Description": "Download PDF Document By Docid",
        "IsSystemLibrary": false,
        "Data": [
          {
            "Name": "Fn",
            "DisplayName": "Python code",
            "Type": 5,
            "Value": "def main(access_token, subscription_id, finon_id, document_id, domain, filename):\r\n    try:\r\n        folder = \"output_path\"\r\n        session = requests.Session()\r\n        # filename = prev_data.get(\"result\", {}).get(\"Title\")\r\n        if not filename:\r\n            raise ValueError(\"Filename (Title) not found in prev_data\")\r\n\r\n        url = f\"https://{domain}/a/webapi/api/browser/downloadRawContent/{document_id}\"\r\n        headers = {\r\n            \"authorization\": f\"Bearer {access_token}\",\r\n            \"finonid\": str(finon_id),\r\n            \"subscriptionid\": str(subscription_id),\r\n        }\r\n\r\n        os.makedirs(folder, exist_ok=True)\r\n        local_file_path = os.path.join(folder, filename)\r\n\r\n        response = session.get(url, headers=headers)\r\n        if response.status_code == 200:\r\n            with open(local_file_path, \"wb\") as f:\r\n                f.write(response.content)\r\n            print(f\"PDF saved successfully at {local_file_path}\")\r\n        elif response.status_code == 204:\r\n            print(\"No content available for the requested document.\")\r\n            return\r\n        else:\r\n            print(f\"Failed to download PDF. Status code: {response.status_code}\")\r\n            print(\"Response content:\", response.text)\r\n            return\r\n        print(f\"PDF downloaded successfully: {local_file_path}\")\r\n    except Exception as e:\r\n        print(f\"Failed to upload to Azure Blob Storage: {e}\")",
            "Data": [],
            "LookupParameters": null
          },
          {
            "Name": "Context",
            "DisplayName": "Parameters",
            "Type": 6,
            "Value": null,
            "Data": [
              {
                "Name": "access_token",
                "DisplayName": "",
                "Type": 8,
                "Value": "",
                "Data": [],
                "LookupParameters": []
              },
              {
                "Name": "subscription_id",
                "DisplayName": "",
                "Type": 8,
                "Value": "",
                "Data": [],
                "LookupParameters": []
              },
              {
                "Name": "finon_id",
                "DisplayName": "",
                "Type": 8,
                "Value": "",
                "Data": [],
                "LookupParameters": []
              },
              {
                "Name": "document_id",
                "DisplayName": "",
                "Type": 8,
                "Value": "",
                "Data": [],
                "LookupParameters": []
              },
              {
                "Name": "domain",
                "DisplayName": "",
                "Type": 8,
                "Value": "",
                "Data": [],
                "LookupParameters": []
              },
              {
                "Name": "filename",
                "DisplayName": "",
                "Type": 8,
                "Value": "",
                "Data": [],
                "LookupParameters": []
              }
            ],
            "LookupParameters": null
          }
        ],
        "Templates": [],
        "LibraryType": 6,
        "UserEmail": "rahul@botminds.ai",
        "IsDeleted": false
      },
      {
        "Id": "7d555e2660fa8975b81851a2fb639bf5",
        "SubscriptionId": "160fcc8dd85b45db8c0ae8b96df54c99",
        "LibraryName": "Threshold check",
        "EndpointUrl": "https://dev.botminds.ai/a/prefect/tasks/pythonOperator",
        "Description": "Threshold check",
        "IsSystemLibrary": false,
        "Data": [
          {
            "Name": "Fn",
            "DisplayName": "Python code",
            "Type": 5,
            "Value": "def main(prev_data, threshold=13):\r\n    voice_count = 0\r\n    challenge_id = None\r\n    \r\n    try:\r\n        if not isinstance(prev_data, dict):\r\n            print(\"Error: Input data must be a dictionary\")\r\n            return None\r\n        \r\n        # Navigate: DOC SUMMARY -> LABEL SUMMARY -> LABEL COUNT\r\n        doc_summary = prev_data.get('DocSummary', {})\r\n        label_summary = doc_summary.get('LabelSummary', [])\r\n        \r\n        # Define the labels we want to extract\r\n        target_labels = {'No of Voices', 'Challenge ID'}\r\n        \r\n        # Loop through LabelSummary to find the learner\r\n        for learner in label_summary:\r\n            label_count = learner.get('LabelCount', [])\r\n            \r\n            # Loop through LabelCount to find specific labels\r\n            for label in label_count:\r\n                label_name = label.get('LabelName', '')\r\n                \r\n                # Check if this label is one we want to extract\r\n                if label_name in target_labels:\r\n                    segment_list = label.get('SegmentList', [])\r\n                    if segment_list:\r\n                        first_segment = segment_list[0]\r\n                        extraction_details = first_segment.get('ExtractionDetails', [])\r\n                        if extraction_details:\r\n                            attribute_value = extraction_details[0].get('AttributeValue')\r\n                            \r\n                            # Assign the value based on the label type\r\n                            if label_name == 'No of Voices':\r\n                                voice_count = int(attribute_value or '0')\r\n                                print(f\"Found No of Voices: {voice_count}\")\r\n                            else:  # Challenge ID\r\n                                challenge_id = attribute_value\r\n                                print(f\"Found Challenge ID: {challenge_id}\")\r\n        \r\n        # Convert threshold to integer\r\n        threshold = int(threshold)\r\n        \r\n    except Exception as e:\r\n        print(f\"Error processing data: {e}\")\r\n        return None\r\n    \r\n    print(f\"Final Extracted - Voice Count: {voice_count}, Challenge ID: {challenge_id}\")\r\n    \r\n    # Calculate the last threshold that was passed\r\n    last_threshold = (voice_count // threshold) * threshold\r\n    \r\n    # Calculate the next threshold to be reached\r\n    next_threshold = last_threshold + threshold\r\n    \r\n    # Check if threshold is exceeded\r\n    exceeded = voice_count > 0 and voice_count % threshold == 0\r\n    \r\n    print(f\"Threshold check - Exceeded: {exceeded}, Current: {voice_count}, Threshold: {threshold}\")\r\n    \r\n    # Only return result if threshold is exceeded and challenge_id exists\r\n    if exceeded and challenge_id:\r\n        result = {\r\n            \"exceeded\": exceeded,\r\n            \"current_count\": voice_count,\r\n            \"last_threshold\": last_threshold,\r\n            \"next_threshold\": next_threshold,\r\n            \"challenge_id\": challenge_id\r\n        }\r\n        print(result)\r\n        return challenge_id\r\n    \r\n    # Return None if threshold not exceeded or no challenge_id\r\n    return None\r\n",
            "Data": [],
            "LookupParameters": null
          },
          {
            "Name": "Context",
            "DisplayName": "Parameters",
            "Type": 6,
            "Value": null,
            "Data": [
              {
                "Name": "prev_data",
                "DisplayName": "",
                "Type": 8,
                "Value": "",
                "Data": [],
                "LookupParameters": []
              },
              {
                "Name": "threshold",
                "DisplayName": "",
                "Type": 8,
                "Value": "",
                "Data": [],
                "LookupParameters": []
              }
            ],
            "LookupParameters": null
          }
        ],
        "Templates": [],
        "LibraryType": 6,
        "UserEmail": "harsha@botminds.ai",
        "IsDeleted": false
      }
    ]
  }
}